<div
*ngIf="topic"
#headerContainer
class="header"
>
  <div class="title">
    <button
    mat-icon-button
    aria-label="Upward"
    (click)="goToParentTopic()"
    >
      <mat-icon>arrow_upward</mat-icon>
    </button>
    <h1>{{ topic?.name }}</h1>
  </div>
  <div
  *ngIf="extraChats?.length > 0"
  class="other-chat"
  >
    <h3>{{ 'GROUP.ROOM.CHAT.ALL_CHATS' | translate }}</h3>
    <app-message
    #otherMessageComponent
    *ngFor="let chat of extraChats; let i = index"
    (click)="onOtherChatClick(chat)"
    [name]="chat.user?.name"
    [category]="chat.category"
    [user_id]="chat.user?.id"
    [message]="chat.content"
    [date]="chat?.createdAt"
    [attaches]="chat?.meta?.attaches"
    [isAllowControl]="false"
    [color]="chat?.user?.color || '#46a35e'"
    [isShowTime]="true"
  ></app-message>
  </div>

</div>
<div
  #chatContainer
  [style.height]="chatContainerHeight"
  (scroll)="onScroll($event)"
  (mouseover)="onMouseOver()"
  (touchstart)="onTouchStart()"
  (touchend)="onTouchEnd()"
  (mouseleave)="onMouseLeave()"
  class="chats"
>
  <app-skeleton-loader
    *ngIf="isLoading && !isFullyLoad"
    count="6"
  ></app-skeleton-loader>
  <app-message
    #messageComponent
    *ngFor="let chat of chats; let i = index"
    (reply)="replyChat = chat"
    (update)="executeAutoScroll()"
    [name]="chat.user?.name"
    [user_id]="chat.user?.id"
    [category]="chat.category"
    [message]="chat.content"
    [date]="chat?.createdAt"
    [attaches]="chat?.meta?.attaches"
    [meta]="chat?.meta"
    [isHideProfile]="isHideName(chat, i)"
    [isAllowControl]="true"
    [color]="chat?.user?.color || '#46a35e'"
    [isShowTime]="true"
  ></app-message>
</div>


<div
  *ngIf="!room"
  class="loader"
>
  <app-skeleton-loader
    count="10"
  ></app-skeleton-loader>
</div>

<div
  class="footer"
  [style.width]="footerWidth"
>
<input
  #fileInput
  type="file"
  class="fileInput"
  multiple="multiple"
  (change)="onFileSelected($event)"
/>
<div
*ngIf="files?.length > 0 || replyChat"
class="input_panel"
>

<div
*ngIf="replyChat"
class="reply"
>
  <div class="header">
    <h1>Reply to {{ replyChat.user?.name }}</h1>
    <mat-icon (click)="replyChat = null">close</mat-icon>
  </div>
  <app-message
    [name]="replyChat.user?.name"
    [user_id]="replyChat.user?.id"
    [message]="replyChat.content"
    [date]="replyChat?.createdAt"
    [attaches]="replyChat?.meta?.attaches"
    [color]="replyChat?.user?.color || '#46a35e'"
    [isShowTime]="true"
  ></app-message>
</div>

<div
*ngIf="files?.length > 0"
class="attachment"
>
  <app-thumbnail
    *ngFor="let file of files"
    (click)="openAttachDeleteDialog(file)"
    [isClickable]="true"
    [src]="getSrcText(file)"
  ></app-thumbnail>
</div>
</div>
  <mat-error *ngIf="chatErrorMessage">
    {{ chatErrorMessage | translate }}
  </mat-error>
  <mat-progress-bar
    *ngIf="uploadingFiles > 0"
    mode="indeterminate"
  ></mat-progress-bar>
  <mat-form-field
    (touchstart)="isMultiLineEnabled = true"
    (mousedown)="this.message?.length === 0 ? isMultiLineEnabled = false : null"
    appearance="outline"
  >
    <textarea
      matInput
      appTextareaAutoResize
      [(ngModel)]="message"
      [disabled]="isDisabled || uploadingFiles > 0"
      [placeholder]=" (isDisabled ? 'GROUP.ROOM.CHAT.DISABLED' : 'GROUP.ROOM.CHAT.WRITE_A_MESSAGE') | translate"
      [multiline]="isMultiLineEnabled"
      [defaultHeight]="DEFAULT_FOOTER_HEIGHT"
      (keyup.enter)="onSendKeyPress($event, message)"
      (keydown.control.enter)="makeNewLine($event)"
      (heightUpdate)="onChatFieldResize($event)"
      id="chat_message_input"
      type="text"
      autocomplete="off"
      
    ></textarea>

    <button
      mat-icon-button
      matSuffix
      [attr.aria-label]="'GROUP.ROOM.CHAT.ATTACH_A_FILE' | translate"
      (click)="onFileButtonClick($event)"
      (touchend)="onFileButtonClick($event)"
    >
      <mat-icon matSuffix>attach_file</mat-icon>
    </button>

    <button
      *ngIf="!isShortWidth"
      mat-icon-button
      matSuffix
      [attr.aria-label]="'GROUP.ROOM.CHAT.EMOJI' | translate"
    >
      <mat-icon matSuffix>sentiment_very_satisfied</mat-icon>
    </button>
    <button
      #send_button
      mat-icon-button
      matSuffix
      (click)="onSendButtonClicked(message)"
      [attr.aria-label]="'GROUP.ROOM.CHAT.SEND' | translate"
    >
      <mat-icon
        matSuffix
      >send</mat-icon>
    </button>
  </mat-form-field>
</div>

